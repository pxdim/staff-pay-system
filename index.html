<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>戶外LED電視牆專業計算機 - 租賃/採購雙模式</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.6s ease;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .mode-badge {
            display: inline-block;
            background: rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            font-weight: 600;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: fadeInUp 0.8s ease;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            font-size: 1.2em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 0.95em;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input[type="number"], select {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .unit {
            color: #777;
            font-weight: 500;
            white-space: nowrap;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #555;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .result-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

        .result-item:hover {
            transform: scale(1.02);
        }

        .result-label {
            font-size: 0.85em;
            color: #777;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-value {
            font-size: 1.5em;
            color: #333;
            font-weight: 700;
        }

        .result-value.highlight {
            color: #667eea;
        }

        .visual-preview {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            text-align: center;
        }

        .led-grid {
            display: inline-grid;
            gap: 2px;
            padding: 20px;
            background: #333;
            border-radius: 10px;
            margin-top: 15px;
        }

        .led-panel {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            border-radius: 2px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .info-box h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .info-box ul {
            list-style: none;
            color: #856404;
        }

        .info-box ul li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .info-box ul li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        .advanced-settings {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .toggle-advanced {
            cursor: pointer;
            color: #667eea;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-advanced:hover {
            color: #764ba2;
        }

        .advanced-content {
            margin-top: 20px;
            display: none;
        }

        .advanced-content.show {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        .cost-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .cost-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .cost-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .cost-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .cost-value {
            font-size: 1.3em;
            font-weight: 700;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .export-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(67, 233, 123, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(67, 233, 123, 0.4);
        }

        .rental-highlight {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            padding: 15px;
            border-radius: 10px;
            color: white;
            margin-bottom: 20px;
        }

        .rental-highlight h3 {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🖥️ 戶外LED電視牆專業計算機</h1>
            <p>精確計算LED電視牆尺寸、模組數量、線材需求及成本預估</p>
            <div class="mode-badge" id="modeBadge">採購模式</div>
        </div>

        <div class="main-grid">
            <!-- 輸入區域 -->
            <div class="card">
                <h2 class="card-title">
                    <span class="icon">📐</span>
                    基本參數設定
                </h2>
                
                <div class="input-group">
                    <label>業務模式</label>
                    <select id="businessMode" onchange="switchBusinessMode()">
                        <option value="purchase">採購模式</option>
                        <option value="rental">租賃模式</option>
                    </select>
                </div>

                <div id="rentalOptions" style="display:none;">
                    <div class="rental-highlight">
                        <h3>🎪 租賃專屬設定</h3>
                        <div class="input-group">
                            <label>租賃天數</label>
                            <div class="input-wrapper">
                                <input type="number" id="rentalDays" value="3" min="1">
                                <span class="unit">天</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>快速選擇常用規格</label>
                            <select id="quickSpec" onchange="applyQuickSpec()">
                                <option value="">-- 自定義 --</option>
                                <option value="p2.6">P2.6 室內 (500×500mm)</option>
                                <option value="p3.91">P3.91 室內/戶外 (500×500mm)</option>
                                <option value="p4.81">P4.81 戶外 (500×500mm)</option>
                                <option value="p6.25">P6.25 戶外 (500×500mm)</option>
                                <option value="p2.976">P2.976 室內 (500×500mm)</option>
                                <option value="p3.91-250">P3.91 室內 (250×250mm)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>螢幕對角線尺寸</label>
                    <div class="input-wrapper">
                        <input type="number" id="screenSize" value="300" min="1" max="9999">
                        <span class="unit">吋</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>長寬比例</label>
                    <select id="aspectRatio">
                        <option value="16:9">16:9 (標準)</option>
                        <option value="21:9">21:9 (超寬)</option>
                        <option value="4:3">4:3 (傳統)</option>
                        <option value="custom">自定義</option>
                    </select>
                </div>

                <div id="customRatio" style="display:none;">
                    <div class="input-group">
                        <label>自定義比例</label>
                        <div class="input-wrapper">
                            <input type="number" id="customWidth" value="16" min="1">
                            <span class="unit">:</span>
                            <input type="number" id="customHeight" value="9" min="1">
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>單片LED模組尺寸</label>
                    <div class="input-wrapper">
                        <input type="number" id="panelWidth" value="500" min="1">
                        <span class="unit">mm ×</span>
                        <input type="number" id="panelHeight" value="500" min="1">
                        <span class="unit">mm</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>
                        <span class="tooltip">
                            像素間距 (Pixel Pitch)
                            <span class="tooltiptext">像素間距越小，解析度越高，適合近距離觀看。戶外通常使用6-10mm</span>
                        </span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="pixelPitch" value="8" min="0.1" max="50" step="0.1">
                        <span class="unit">mm</span>
                    </div>
                </div>

                <div class="advanced-settings">
                    <div class="toggle-advanced" onclick="toggleAdvanced()">
                        <span>⚙️</span>
                        <span>進階設定</span>
                        <span id="advancedArrow">▼</span>
                    </div>
                    <div id="advancedContent" class="advanced-content">
                        <div class="input-group">
                            <label>單片模組功耗</label>
                            <div class="input-wrapper">
                                <input type="number" id="panelPower" value="50" min="1">
                                <span class="unit">W</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>亮度</label>
                            <div class="input-wrapper">
                                <input type="number" id="brightness" value="6500" min="1000" max="10000" step="500">
                                <span class="unit">cd/m²</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>刷新率</label>
                            <div class="input-wrapper">
                                <select id="refreshRate">
                                    <option value="1920">1920Hz</option>
                                    <option value="3840" selected>3840Hz</option>
                                    <option value="7680">7680Hz</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>控制卡負載能力</label>
                            <div class="input-wrapper">
                                <input type="number" id="controlCardCapacity" value="655360" min="1">
                                <span class="unit">像素</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>接收卡網口數量</label>
                            <div class="input-wrapper">
                                <input type="number" id="receiverPorts" value="2" min="1" max="16">
                                <span class="unit">個</span>
                            </div>
                        </div>
                        
                        <h4 style="margin-top: 25px; margin-bottom: 15px; color: #667eea; border-top: 2px solid #e0e0e0; padding-top: 20px;">💰 成本參數設定</h4>
                        
                        <div id="purchaseCostParams">
                            <div class="input-group">
                                <label>LED模組單價</label>
                                <div class="input-wrapper">
                                    <input type="number" id="panelUnitPrice" value="2000" min="1">
                                    <span class="unit">NT$/片</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>發送卡單價</label>
                                <div class="input-wrapper">
                                    <input type="number" id="senderCardPrice" value="5000" min="1">
                                    <span class="unit">NT$/張</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>接收卡單價</label>
                                <div class="input-wrapper">
                                    <input type="number" id="receiverCardPrice" value="800" min="1">
                                    <span class="unit">NT$/張</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>網路線單價</label>
                                <div class="input-wrapper">
                                    <input type="number" id="networkCablePrice" value="200" min="1">
                                    <span class="unit">NT$/條</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>電源線單價</label>
                                <div class="input-wrapper">
                                    <input type="number" id="powerCablePrice" value="500" min="1">
                                    <span class="unit">NT$/條</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>鋼構單價</label>
                                <div class="input-wrapper">
                                    <input type="number" id="structurePrice" value="3000" min="1">
                                    <span class="unit">NT$/m²</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>安裝人工單價</label>
                                <div class="input-wrapper">
                                    <input type="number" id="laborPrice" value="1500" min="1">
                                    <span class="unit">NT$/m²</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="rentalCostParams" style="display:none;">
                            <div class="input-group">
                                <label>LED模組租金</label>
                                <div class="input-wrapper">
                                    <input type="number" id="panelRentalPrice" value="2000" min="1">
                                    <span class="unit">NT$/片/天</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>運輸費用</label>
                                <div class="input-wrapper">
                                    <input type="number" id="transportPrice" value="20000" min="0">
                                    <span class="unit">NT$ (來回)</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>安裝拆卸費</label>
                                <div class="input-wrapper">
                                    <input type="number" id="installPrice" value="500" min="0">
                                    <span class="unit">NT$/m²</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>技術人員費</label>
                                <div class="input-wrapper">
                                    <input type="number" id="technicianPrice" value="8000" min="0">
                                    <span class="unit">NT$/人/天</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>需要技術人員數</label>
                                <div class="input-wrapper">
                                    <input type="number" id="technicianCount" value="2" min="0">
                                    <span class="unit">人</span>
                                </div>
                            </div>
                            <div class="input-group">
                                <label>設備保險費率</label>
                                <div class="input-wrapper">
                                    <input type="number" id="insuranceRate" value="3" min="0" max="100" step="0.1">
                                    <span class="unit">%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="calculate()">計算</button>
                    <button class="btn btn-secondary" onclick="reset()">重置</button>
                </div>
            </div>

            <!-- 結果區域 -->
            <div class="card">
                <h2 class="card-title">
                    <span class="icon">📊</span>
                    計算結果
                </h2>

                <div id="results" style="display:none;">
                    <!-- 尺寸結果 -->
                    <div class="result-section">
                        <h3 style="margin-bottom: 15px; color: #333;">📏 實際尺寸</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">實際寬度</div>
                                <div class="result-value highlight" id="actualWidth">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">實際高度</div>
                                <div class="result-value highlight" id="actualHeight">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">總面積</div>
                                <div class="result-value" id="totalArea">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">對角線</div>
                                <div class="result-value" id="diagonal">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- 模組結果 -->
                    <div class="result-section">
                        <h3 style="margin-bottom: 15px; color: #333;">🔲 模組配置</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">橫向模組數</div>
                                <div class="result-value highlight" id="panelsWide">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">縱向模組數</div>
                                <div class="result-value highlight" id="panelsHigh">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">總模組數</div>
                                <div class="result-value" id="totalPanels">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">備用模組(5%)</div>
                                <div class="result-value" id="sparePanels">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- 解析度結果 -->
                    <div class="result-section">
                        <h3 style="margin-bottom: 15px; color: #333;">🖼️ 解析度與像素</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">水平解析度</div>
                                <div class="result-value" id="horizontalRes">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">垂直解析度</div>
                                <div class="result-value" id="verticalRes">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">總像素數</div>
                                <div class="result-value highlight" id="totalPixels">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">像素密度</div>
                                <div class="result-value" id="pixelDensity">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- 線材與電力結果 -->
                    <div class="result-section">
                        <h3 style="margin-bottom: 15px; color: #333;">🔌 線材與電力需求</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">主網路線數</div>
                                <div class="result-value highlight" id="networkCables">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">電源線數</div>
                                <div class="result-value highlight" id="powerCables">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">總功耗</div>
                                <div class="result-value" id="totalPower">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">建議電源</div>
                                <div class="result-value" id="suggestedPower">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- 控制系統 -->
                    <div class="result-section">
                        <h3 style="margin-bottom: 15px; color: #333;">🎮 控制系統</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">發送卡數量</div>
                                <div class="result-value" id="senderCards">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">接收卡數量</div>
                                <div class="result-value" id="receiverCards">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">視頻處理器</div>
                                <div class="result-value" id="videoProcessor">-</div>
                            </div>
                            <div class="result-item">
                                <div class="result-label">控制電腦</div>
                                <div class="result-value" id="controlPC">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- 成本估算 -->
                    <div class="cost-section">
                        <h3 style="margin-bottom: 15px;">💰 成本估算 (參考)</h3>
                        <div class="cost-grid">
                            <div class="cost-item">
                                <div class="cost-label" id="cost-label-1">LED模組</div>
                                <div class="cost-value" id="panelCost">-</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label" id="cost-label-2">控制系統</div>
                                <div class="cost-value" id="controlCost">-</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label" id="cost-label-3">線材配件</div>
                                <div class="cost-value" id="cableCost">-</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label" id="cost-label-4">安裝結構</div>
                                <div class="cost-value" id="structureCost">-</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label" id="cost-label-5">人工安裝</div>
                                <div class="cost-value" id="laborCost">-</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label">總計估算</div>
                                <div class="cost-value" id="totalCost" style="font-size: 1.5em;">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- 視覺預覽 -->
                    <div class="visual-preview">
                        <h3 style="margin-bottom: 10px; color: #333;">🎨 模組排列預覽</h3>
                        <div id="ledGridPreview"></div>
                        <p style="margin-top: 15px; color: #666; font-size: 0.9em;">
                            每個方塊代表一個LED模組
                        </p>
                    </div>

                    <!-- 建議資訊 -->
                    <div class="info-box">
                        <h4>💡 專業建議</h4>
                        <ul id="suggestions">
                            <!-- 動態生成建議 -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="export-btn" onclick="exportResults()">📥 匯出報告</button>

    <script>
        // 切換業務模式
        function switchBusinessMode() {
            const mode = document.getElementById('businessMode').value;
            const rentalOptions = document.getElementById('rentalOptions');
            const purchaseCostParams = document.getElementById('purchaseCostParams');
            const rentalCostParams = document.getElementById('rentalCostParams');
            const modeBadge = document.getElementById('modeBadge');
            
            if (mode === 'rental') {
                rentalOptions.style.display = 'block';
                if (purchaseCostParams) purchaseCostParams.style.display = 'none';
                if (rentalCostParams) rentalCostParams.style.display = 'block';
                modeBadge.textContent = '租賃模式';
                modeBadge.style.background = 'rgba(255, 216, 155, 0.5)';
            } else {
                rentalOptions.style.display = 'none';
                if (purchaseCostParams) purchaseCostParams.style.display = 'block';
                if (rentalCostParams) rentalCostParams.style.display = 'none';
                modeBadge.textContent = '採購模式';
                modeBadge.style.background = 'rgba(255, 255, 255, 0.3)';
            }
        }

        // 套用快速規格
        function applyQuickSpec() {
            const spec = document.getElementById('quickSpec').value;
            const specs = {
                'p2.6': { pitch: 2.6, width: 500, height: 500 },
                'p3.91': { pitch: 3.91, width: 500, height: 500 },
                'p4.81': { pitch: 4.81, width: 500, height: 500 },
                'p6.25': { pitch: 6.25, width: 500, height: 500 },
                'p2.976': { pitch: 2.976, width: 500, height: 500 },
                'p3.91-250': { pitch: 3.91, width: 250, height: 250 }
            };
            
            if (spec && specs[spec]) {
                document.getElementById('pixelPitch').value = specs[spec].pitch;
                document.getElementById('panelWidth').value = specs[spec].width;
                document.getElementById('panelHeight').value = specs[spec].height;
            }
        }

        // 切換進階設定
        function toggleAdvanced() {
            const content = document.getElementById('advancedContent');
            const arrow = document.getElementById('advancedArrow');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                arrow.textContent = '▼';
            } else {
                content.classList.add('show');
                arrow.textContent = '▲';
            }
        }

        // 監聽長寬比選擇
        document.getElementById('aspectRatio').addEventListener('change', function() {
            const customRatio = document.getElementById('customRatio');
            if (this.value === 'custom') {
                customRatio.style.display = 'block';
            } else {
                customRatio.style.display = 'none';
            }
        });

        // 計算函數
        function calculate() {
            // 獲取輸入值
            const screenSize = parseFloat(document.getElementById('screenSize').value);
            const aspectRatioSelect = document.getElementById('aspectRatio').value;
            const panelWidth = parseFloat(document.getElementById('panelWidth').value);
            const panelHeight = parseFloat(document.getElementById('panelHeight').value);
            const pixelPitch = parseFloat(document.getElementById('pixelPitch').value);
            const panelPower = parseFloat(document.getElementById('panelPower').value);
            const brightness = parseFloat(document.getElementById('brightness').value);
            const refreshRate = parseFloat(document.getElementById('refreshRate').value);
            const controlCardCapacity = parseFloat(document.getElementById('controlCardCapacity').value);
            const receiverPorts = parseFloat(document.getElementById('receiverPorts').value);
            const businessMode = document.getElementById('businessMode').value;

            // 計算長寬比
            let ratioWidth, ratioHeight;
            if (aspectRatioSelect === 'custom') {
                ratioWidth = parseFloat(document.getElementById('customWidth').value);
                ratioHeight = parseFloat(document.getElementById('customHeight').value);
            } else {
                const ratios = {
                    '16:9': [16, 9],
                    '21:9': [21, 9],
                    '4:3': [4, 3]
                };
                [ratioWidth, ratioHeight] = ratios[aspectRatioSelect];
            }

            // 計算實際尺寸（英寸轉毫米）
            const inchToMm = 25.4;
            const diagonal = screenSize * inchToMm;
            const ratio = ratioWidth / ratioHeight;
            const height = Math.sqrt(diagonal * diagonal / (1 + ratio * ratio));
            const width = height * ratio;

            // 計算需要的模組數量
            const panelsWide = Math.ceil(width / panelWidth);
            const panelsHigh = Math.ceil(height / panelHeight);
            const totalPanels = panelsWide * panelsHigh;
            const sparePanels = Math.ceil(totalPanels * 0.05);

            // 計算實際尺寸
            const actualWidth = panelsWide * panelWidth;
            const actualHeight = panelsHigh * panelHeight;
            const totalArea = (actualWidth * actualHeight) / 1000000; // 平方米

            // 計算解析度
            const horizontalRes = Math.floor(actualWidth / pixelPitch);
            const verticalRes = Math.floor(actualHeight / pixelPitch);
            const totalPixels = horizontalRes * verticalRes;
            const pixelDensity = Math.round(totalPixels / totalArea);

            // 計算線材需求
            const networkCables = Math.ceil(totalPixels / controlCardCapacity);
            const powerCables = Math.ceil(totalPanels / 4); // 假設每4個模組一條電源線
            const totalPower = totalPanels * panelPower;
            const suggestedPower = Math.ceil(totalPower * 1.3 / 1000) * 1000; // 留30%餘量

            // 計算控制系統
            const senderCards = networkCables;
            const receiverCards = Math.ceil(totalPanels / receiverPorts);
            const videoProcessor = totalPixels > 2073600 ? "4K處理器" : "2K處理器";
            const controlPC = totalPixels > 8294400 ? "高配工作站" : "標準控制電腦";

            // 成本估算
            let panelCost, controlCost, cableCost, structureCost, laborCost, totalCost;
            
            if (businessMode === 'rental') {
                // 租賃模式計算
                const rentalDays = parseFloat(document.getElementById('rentalDays').value) || 3;
                const panelRentalPrice = parseFloat(document.getElementById('panelRentalPrice').value) || 2000;
                const transportPrice = parseFloat(document.getElementById('transportPrice').value) || 20000;
                const installPrice = parseFloat(document.getElementById('installPrice').value) || 500;
                const technicianPrice = parseFloat(document.getElementById('technicianPrice').value) || 8000;
                const technicianCount = parseFloat(document.getElementById('technicianCount').value) || 2;
                const insuranceRate = parseFloat(document.getElementById('insuranceRate').value) || 3;
                
                panelCost = totalPanels * panelRentalPrice * rentalDays;
                const transportCost = transportPrice;
                const installationCost = totalArea * installPrice * 2; // 安裝+拆卸
                const technicianCost = technicianPrice * technicianCount * rentalDays;
                const insuranceCost = panelCost * (insuranceRate / 100);
                
                // 租賃模式下的顯示調整
                document.getElementById('panelCost').textContent = `NT$ ${panelCost.toLocaleString()}`;
                document.getElementById('controlCost').textContent = `NT$ ${transportCost.toLocaleString()}`;
                document.getElementById('cableCost').textContent = `NT$ ${installationCost.toLocaleString()}`;
                document.getElementById('structureCost').textContent = `NT$ ${technicianCost.toLocaleString()}`;
                document.getElementById('laborCost').textContent = `NT$ ${insuranceCost.toLocaleString()}`;
                
                // 更新標籤文字
                document.getElementById('cost-label-1').textContent = `租金(${rentalDays}天)`;
                document.getElementById('cost-label-2').textContent = '運輸費用';
                document.getElementById('cost-label-3').textContent = '安裝拆卸';
                document.getElementById('cost-label-4').textContent = '技術人員';
                document.getElementById('cost-label-5').textContent = '設備保險';
                
                totalCost = panelCost + transportCost + installationCost + technicianCost + insuranceCost;
            } else {
                // 採購模式計算
                const panelUnitPrice = parseFloat(document.getElementById('panelUnitPrice').value);
                const senderCardPrice = parseFloat(document.getElementById('senderCardPrice').value);
                const receiverCardPrice = parseFloat(document.getElementById('receiverCardPrice').value);
                const networkCablePrice = parseFloat(document.getElementById('networkCablePrice').value);
                const powerCablePrice = parseFloat(document.getElementById('powerCablePrice').value);
                const structurePrice = parseFloat(document.getElementById('structurePrice').value);
                const laborPrice = parseFloat(document.getElementById('laborPrice').value);
                
                panelCost = totalPanels * panelUnitPrice;
                controlCost = senderCards * senderCardPrice + receiverCards * receiverCardPrice;
                cableCost = (networkCables * networkCablePrice + powerCables * powerCablePrice);
                structureCost = totalArea * structurePrice;
                laborCost = totalArea * laborPrice;
                totalCost = panelCost + controlCost + cableCost + structureCost + laborCost;
                
                // 恢復原始標籤
                document.getElementById('cost-label-1').textContent = 'LED模組';
                document.getElementById('cost-label-2').textContent = '控制系統';
                document.getElementById('cost-label-3').textContent = '線材配件';
                document.getElementById('cost-label-4').textContent = '安裝結構';
                document.getElementById('cost-label-5').textContent = '人工安裝';
                
                document.getElementById('panelCost').textContent = `NT$ ${panelCost.toLocaleString()}`;
                document.getElementById('controlCost').textContent = `NT$ ${controlCost.toLocaleString()}`;
                document.getElementById('cableCost').textContent = `NT$ ${cableCost.toLocaleString()}`;
                document.getElementById('structureCost').textContent = `NT$ ${structureCost.toLocaleString()}`;
                document.getElementById('laborCost').textContent = `NT$ ${laborCost.toLocaleString()}`;
            }

            // 更新顯示結果
            document.getElementById('actualWidth').textContent = `${(actualWidth/1000).toFixed(2)} m`;
            document.getElementById('actualHeight').textContent = `${(actualHeight/1000).toFixed(2)} m`;
            document.getElementById('totalArea').textContent = `${totalArea.toFixed(2)} m²`;
            document.getElementById('diagonal').textContent = `${(Math.sqrt(actualWidth*actualWidth + actualHeight*actualHeight)/inchToMm).toFixed(1)} 吋`;

            document.getElementById('panelsWide').textContent = panelsWide;
            document.getElementById('panelsHigh').textContent = panelsHigh;
            document.getElementById('totalPanels').textContent = totalPanels;
            document.getElementById('sparePanels').textContent = sparePanels;

            document.getElementById('horizontalRes').textContent = `${horizontalRes} px`;
            document.getElementById('verticalRes').textContent = `${verticalRes} px`;
            document.getElementById('totalPixels').textContent = totalPixels.toLocaleString();
            document.getElementById('pixelDensity').textContent = `${pixelDensity.toLocaleString()} px/m²`;

            document.getElementById('networkCables').textContent = `${networkCables} 條`;
            document.getElementById('powerCables').textContent = `${powerCables} 條`;
            document.getElementById('totalPower').textContent = `${(totalPower/1000).toFixed(1)} kW`;
            document.getElementById('suggestedPower').textContent = `${(suggestedPower/1000).toFixed(0)} kW`;

            document.getElementById('senderCards').textContent = senderCards;
            document.getElementById('receiverCards').textContent = receiverCards;
            document.getElementById('videoProcessor').textContent = videoProcessor;
            document.getElementById('controlPC').textContent = controlPC;

            document.getElementById('totalCost').textContent = `NT$ ${totalCost.toLocaleString()}`;

            // 生成視覺預覽
            generateVisualPreview(panelsWide, panelsHigh);

            // 生成建議
            generateSuggestions(pixelPitch, totalArea, totalPixels, brightness, businessMode);

            // 顯示結果
            document.getElementById('results').style.display = 'block';
        }

        // 生成視覺預覽
        function generateVisualPreview(wide, high) {
            const preview = document.getElementById('ledGridPreview');
            const maxDisplay = 20; // 最多顯示20x20
            const displayWide = Math.min(wide, maxDisplay);
            const displayHigh = Math.min(high, maxDisplay);
            
            let gridHtml = `<div class="led-grid" style="grid-template-columns: repeat(${displayWide}, 1fr);">`;
            
            for (let i = 0; i < displayWide * displayHigh; i++) {
                gridHtml += '<div class="led-panel"></div>';
            }
            
            gridHtml += '</div>';
            
            if (wide > maxDisplay || high > maxDisplay) {
                gridHtml += `<p style="margin-top: 10px; color: #999; font-size: 0.85em;">
                    (預覽顯示 ${displayWide}×${displayHigh}，實際為 ${wide}×${high})
                </p>`;
            }
            
            preview.innerHTML = gridHtml;
        }

        // 生成建議
        function generateSuggestions(pixelPitch, area, pixels, brightness, mode) {
            const suggestions = document.getElementById('suggestions');
            let suggestionList = [];

            // 根據像素間距建議觀看距離
            const minDistance = pixelPitch * 1;
            const optimalDistance = pixelPitch * 3;
            suggestionList.push(`建議觀看距離：${minDistance.toFixed(1)}-${optimalDistance.toFixed(1)}公尺`);

            if (mode === 'rental') {
                // 租賃模式特定建議
                suggestionList.push('租賃前請確認場地電源容量是否足夠');
                suggestionList.push('建議提前進行場地勘察，確認安裝條件');
                suggestionList.push('活動當天建議安排技術人員現場待命');
                suggestionList.push('租賃設備建議購買保險，避免意外損失');
                suggestionList.push('確認運輸車輛可進入場地');
            } else {
                // 採購模式建議
                if (area > 50) {
                    suggestionList.push('大型顯示屏建議配置UPS不斷電系統');
                    suggestionList.push('建議安裝環境監測系統（溫度、濕度、亮度感應）');
                }
                suggestionList.push('建議每季度進行一次專業維護保養');
                suggestionList.push('預留5%備用模組以應對故障更換');
            }

            // 根據解析度建議
            if (pixels > 2073600) {
                suggestionList.push('支援4K內容播放，建議使用專業級視頻處理器');
            }

            // 根據亮度建議
            if (brightness >= 6000) {
                suggestionList.push('高亮度設計適合戶外使用，建議加裝自動亮度調節系統');
            }

            // 更新建議列表
            suggestions.innerHTML = suggestionList.map(s => `<li>${s}</li>`).join('');
        }

        // 重置功能
        function reset() {
            // 重置基本參數
            document.getElementById('screenSize').value = 300;
            document.getElementById('aspectRatio').value = '16:9';
            document.getElementById('panelWidth').value = 500;
            document.getElementById('panelHeight').value = 500;
            document.getElementById('pixelPitch').value = 8;
            document.getElementById('businessMode').value = 'purchase';
            
            // 重置租賃參數
            if (document.getElementById('rentalDays')) {
                document.getElementById('rentalDays').value = 3;
            }
            
            // 重置進階參數
            document.getElementById('panelPower').value = 50;
            document.getElementById('brightness').value = 6500;
            document.getElementById('refreshRate').value = '3840';
            document.getElementById('controlCardCapacity').value = 655360;
            document.getElementById('receiverPorts').value = 2;
            
            // 重置成本參數
            document.getElementById('panelUnitPrice').value = 2000;
            document.getElementById('senderCardPrice').value = 5000;
            document.getElementById('receiverCardPrice').value = 800;
            document.getElementById('networkCablePrice').value = 200;
            document.getElementById('powerCablePrice').value = 500;
            document.getElementById('structurePrice').value = 3000;
            document.getElementById('laborPrice').value = 1500;
            
            // 重置租賃成本參數
            if (document.getElementById('panelRentalPrice')) {
                document.getElementById('panelRentalPrice').value = 2000;
                document.getElementById('transportPrice').value = 20000;
                document.getElementById('installPrice').value = 500;
                document.getElementById('technicianPrice').value = 8000;
                document.getElementById('technicianCount').value = 2;
                document.getElementById('insuranceRate').value = 3;
            }
            
            // 隱藏結果和自定義比例
            document.getElementById('results').style.display = 'none';
            document.getElementById('customRatio').style.display = 'none';
            document.getElementById('rentalOptions').style.display = 'none';
            switchBusinessMode();
        }

        // 匯出報告
        function exportResults() {
            if (document.getElementById('results').style.display === 'none') {
                alert('請先進行計算');
                return;
            }

            const businessMode = document.getElementById('businessMode').value;
            const modeText = businessMode === 'rental' ? '租賃' : '採購';
            
            const results = {
                模式: modeText,
                尺寸: {
                    實際寬度: document.getElementById('actualWidth').textContent,
                    實際高度: document.getElementById('actualHeight').textContent,
                    總面積: document.getElementById('totalArea').textContent,
                    對角線: document.getElementById('diagonal').textContent
                },
                模組配置: {
                    橫向模組數: document.getElementById('panelsWide').textContent,
                    縱向模組數: document.getElementById('panelsHigh').textContent,
                    總模組數: document.getElementById('totalPanels').textContent,
                    備用模組: document.getElementById('sparePanels').textContent
                },
                解析度: {
                    水平解析度: document.getElementById('horizontalRes').textContent,
                    垂直解析度: document.getElementById('verticalRes').textContent,
                    總像素數: document.getElementById('totalPixels').textContent,
                    像素密度: document.getElementById('pixelDensity').textContent
                },
                線材與電力: {
                    主網路線數: document.getElementById('networkCables').textContent,
                    電源線數: document.getElementById('powerCables').textContent,
                    總功耗: document.getElementById('totalPower').textContent,
                    建議電源: document.getElementById('suggestedPower').textContent
                },
                成本估算: {}
            };
            
            // 根據模式導出不同的成本項目
            if (businessMode === 'rental') {
                const rentalDays = document.getElementById('rentalDays').value;
                results.租賃天數 = rentalDays + ' 天';
                results.成本估算 = {
                    [`租金(${rentalDays}天)`]: document.getElementById('panelCost').textContent,
                    運輸費用: document.getElementById('controlCost').textContent,
                    安裝拆卸: document.getElementById('cableCost').textContent,
                    技術人員: document.getElementById('structureCost').textContent,
                    設備保險: document.getElementById('laborCost').textContent,
                    總計: document.getElementById('totalCost').textContent
                };
            } else {
                results.成本估算 = {
                    LED模組: document.getElementById('panelCost').textContent,
                    控制系統: document.getElementById('controlCost').textContent,
                    線材配件: document.getElementById('cableCost').textContent,
                    安裝結構: document.getElementById('structureCost').textContent,
                    人工安裝: document.getElementById('laborCost').textContent,
                    總計: document.getElementById('totalCost').textContent
                };
            }

            const text = JSON.stringify(results, null, 2);
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `LED電視牆${modeText}計算報告_${new Date().toLocaleDateString()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 頁面載入時自動計算一次
        window.onload = function() {
            calculate();
        };
    </script>
</body>
</html>
